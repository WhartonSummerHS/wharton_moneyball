<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Lecture 4: Tidy Data &amp; Regression Introduction</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
div.sourceCode {
  overflow-x: visible;
}
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">WMA19</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-futbol-o"></span>
     
    Lecture Notes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lecture1.html">Lecture 1</a>
    </li>
    <li>
      <a href="lecture2.html">Lecture 2</a>
    </li>
    <li>
      <a href="lecture3.html">Lecture 3</a>
    </li>
    <li>
      <a href="lecture4.html">Lecture 4</a>
    </li>
    <li>
      <a href="lecture5.html">Lecture 5</a>
    </li>
    <li>
      <a href="lecture6.html">Lecture 6</a>
    </li>
    <li>
      <a href="lecture7.html">Lecture 7</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-dribbble"></span>
     
    Problem Sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ps0.html">Problem Set 0</a>
    </li>
    <li>
      <a href="ps1.html">Problem Set 1</a>
    </li>
    <li>
      <a href="ps2.html">Problem Set 2</a>
    </li>
    <li>
      <a href="ps3.html">Problem Set 3</a>
    </li>
    <li>
      <a href="ps4.html">Problem Set 4</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-bar-chart"></span>
     
    Training Camp
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="tc_lecture1.html">Lecture 1</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Lecture 4: Tidy Data &amp; Regression Introduction</h1>

</div>


<div id="tidy-data" class="section level2">
<h2>Tidy Data</h2>
<p>Before we jump into any analysis, we wanted to start by discussing the notion of “tidy data”. <!-- Paraphrase some of the stuff in Hadley's article perhaps? --></p>
<p>To make the above discussion much more concrete, let’s go back to the dataset we created in the challenge question at the end of <a href="ps3.html">Problem Set 3</a>. Each line of this tbl is a “player-season”. Printing out the tbl, we see that there is a separate row for each “player-season”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">library</span>(tidyverse)
&gt;<span class="st"> </span><span class="kw">load</span>(<span class="st">&quot;data/batting_2014_2015.RData&quot;</span>)
&gt;<span class="st"> </span>batting_2014_2015
<span class="co"># A tibble: 140 x 3</span>
<span class="co"># Groups:   playerID [70]</span>
   playerID  yearID    BA
   &lt;chr&gt;<span class="st">      </span><span class="er">&lt;</span>int&gt;<span class="st"> </span><span class="er">&lt;</span>dbl&gt;
<span class="st"> </span><span class="dv">1</span> abreujo02   <span class="dv">2014</span> <span class="fl">0.317</span>
 <span class="dv">2</span> abreujo02   <span class="dv">2015</span> <span class="fl">0.290</span>
 <span class="dv">3</span> altuvjo01   <span class="dv">2014</span> <span class="fl">0.341</span>
 <span class="dv">4</span> altuvjo01   <span class="dv">2015</span> <span class="fl">0.313</span>
 <span class="dv">5</span> andruel01   <span class="dv">2014</span> <span class="fl">0.263</span>
 <span class="dv">6</span> andruel01   <span class="dv">2015</span> <span class="fl">0.258</span>
 <span class="dv">7</span> aybarer01   <span class="dv">2014</span> <span class="fl">0.278</span>
 <span class="dv">8</span> aybarer01   <span class="dv">2015</span> <span class="fl">0.270</span>
 <span class="dv">9</span> bautijo02   <span class="dv">2014</span> <span class="fl">0.286</span>
<span class="dv">10</span> bautijo02   <span class="dv">2015</span> <span class="fl">0.250</span>
<span class="co"># … with 130 more rows</span></code></pre></div>
<p>In order to study the relationship between a player’s 2014 batting average and his 2015 batting average, it will be more convenient to store the data as below.</p>
<pre><code># A tibble: 70 x 3
# Groups:   playerID [70]
   playerID  `2014` `2015`
   &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;
 1 abreujo02  0.317  0.290
 2 altuvjo01  0.341  0.313
 3 andruel01  0.263  0.258
 4 aybarer01  0.278  0.270
 5 bautijo02  0.286  0.250
 6 beltrad01  0.324  0.287
 7 blackch02  0.288  0.287
 8 bogaexa01  0.240  0.320
 9 brantmi02  0.327  0.310
10 braunry02  0.266  0.285
# … with 60 more rows</code></pre>
<p>In this format, we have a row for each player and two columns for his batting averages, one for 2014 and one for 2015. In order to convert our tbl into this format, we use <em>spreading</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>batting_2014_2015 &lt;-
+<span class="st">   </span>batting_2014_2015 %&gt;%
+<span class="st">   </span><span class="kw">spread</span>(yearID, BA)</code></pre></div>
<p>When we print out <code>batting_2014_2015</code> now, we notice that it is a grouped tbl. Before proceeding we will need to remove this grouping</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>batting_2014_2015 &lt;-<span class="st"> </span>
+<span class="st">   </span>batting_2014_2015 %&gt;%
+<span class="st">   </span><span class="kw">ungroup</span>()</code></pre></div>
<p>Notice that the column names of the tbl are now “2014” and “2015”. We can rename these column names</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>batting_2014_2015 &lt;-<span class="st"> </span>
+<span class="st">   </span>batting_2014_2015 %&gt;%
+<span class="st">   </span><span class="kw">rename</span>(<span class="dt">BA_2014 =</span> <span class="st">`</span><span class="dt">2014</span><span class="st">`</span>, <span class="dt">BA_2015 =</span> <span class="st">`</span><span class="dt">2015</span><span class="st">`</span>)</code></pre></div>
</div>
<div id="predicting-batting-averages" class="section level2">
<h2>Predicting Batting Averages</h2>
<p>Imagine there’s one more player who played in both 2014 and 2015 but who is not in our dataset. Without knowing anything else about the player, how could we predict their 2015 batting average using the data that we have? The simplest thing (and as it turns out the best thing) to do in this case is to use the overall mean of the 2015 batting averages in our dataset to predict the batting average of this extra player.</p>
<p>Now what if we also told you this extra player’s 2014 batting average? Can we improve on this simple prediction? In this section, we will propose several different ways of predicting 2015 batting average using 2014 batting average. In order to pick the best one, we can assess how well each method predicts the actual 2015 batting averages in our tbl. We will add columns to our tbl containing these predictions. To get things started, let’s add a column containing the overall mean of the 2015 batting averages. It turns out that this mean is 0.273, whereas the mean 2014 batting average is 0.272.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>batting_2014_2015 &lt;-
+<span class="st">   </span>batting_2014_2015 %&gt;%<span class="st"> </span>
+<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">yhat_0 =</span> <span class="kw">mean</span>(BA_2015))</code></pre></div>
<p>If the 2014 batting average had no predictive power at all, then this overall mean will be the best prediction model possible, given what data we have. Plotting the 2015 batting averages against the 2014 batting averages allows us to assess visually whether there is any relationship between the two variables. We have added dashed red horizontal and vertical lines at the overall means of the 2014 and 2015 data, respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">ggplot</span>(batting_2014_2015) +
+<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BA_2014, <span class="dt">y =</span> BA_2015), <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">shape =</span> <span class="dv">16</span>, <span class="dt">size =</span> <span class="fl">0.9</span>) +
+<span class="st">   </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">0.273</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">lty =</span> <span class="dv">2</span>) +
+<span class="st">   </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">0.272</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="lecture4_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>It certainly looks like there is a relationship! So it’s at least plausible that if we use the 2014 batting averages to make predictions for 2015, we can do better than relying on just the average of the 2015 averages.</p>
<p>Looking carefully at the plot, we see that people with most players with below average batting averages in 2014 tended to also have below average batting averages in 2015. Similarly, most players with above average batting averages in 2014 tended to have above average batting averages in 2015.</p>
<p>One way to improve on the simple prediction above would be as follows:</p>
<ol style="list-style-type: decimal">
<li>Divide the players into two groups, one for those with above average BA in 2014 and one for those with below average BA in 2014.</li>
<li>Average the 2015 BA within each of these groups and use these averages as the prediction for each member of the group.</li>
</ol>
<p>In order to do this, we will need to augment our tbl <code>batting_2014_2015</code> with a column indicating to which group each player belongs. Then we can pass this column to <code>group_by()</code> and compute the average BA_2015 within each group. To create the column indicating group membership, we will use the powerful <code>cut()</code> function, which divides the range of a numerical vector into intervals and recodes the numerical values according to which interval they fall.</p>
<p>The following code chunk does precisely that with two more steps: once we have made our predictions, we ungroup the tbl and we can drop the column indicating the interval in which our observation falls.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>batting_2014_2015 &lt;-<span class="st"> </span>
+<span class="st">   </span>batting_2014_2015 %&gt;%
+<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">bins =</span> <span class="kw">cut</span>(BA_2014, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="fl">0.15</span>, <span class="fl">0.272</span>, <span class="fl">0.40</span>))) %&gt;%
+<span class="st">   </span><span class="kw">group_by</span>(bins) %&gt;%
+<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">yhat_1 =</span> <span class="kw">mean</span>(BA_2015)) %&gt;%
+<span class="st">   </span><span class="kw">ungroup</span>() %&gt;%
+<span class="st">   </span><span class="kw">select</span>(-bins)</code></pre></div>
<p>When we run this code and print out our tbl, we see that there is a new column called “yhat_1” that contains our new predictions. Before proceeding, we should talk a bit about the syntax use in <code>cut()</code>. The first argument is the variable we want to discretize. The next argument, <code>breaks =</code> is a vector that tells R where the endpoints of these intervals are. These are often called “cut points” In this particular case, we wanted to divide the players into those with below average batting averages in 2014 and above average batting averages in 2015. The first element of the cut point vector, 0.15 is much less than the smallest BA_2014 value, whereas the second elements, 0.272, is the overall mean of the BA_2014 values. The last element, 0.40 is much greater than the largest BA_2014 value.</p>
<p>Now that we have two different ways of predicting 2015 batting averages, let us see how they compare, visually.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">ggplot</span>(batting_2014_2015) +
+<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BA_2014, <span class="dt">y =</span> BA_2015), <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">shape =</span> <span class="dv">16</span>, <span class="dt">size =</span> <span class="fl">0.9</span>) +
+<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BA_2014, <span class="dt">y =</span> yhat_0), <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">shape =</span> <span class="dv">3</span>, <span class="dt">size =</span> <span class="fl">0.75</span>) +<span class="st"> </span>
+<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BA_2014, <span class="dt">y =</span> yhat_1), <span class="dt">col =</span> <span class="st">&#39;green&#39;</span>, <span class="dt">shape =</span> <span class="dv">15</span>, <span class="dt">size =</span> <span class="fl">0.75</span>)</code></pre></div>
<p><img src="lecture4_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Visually it appears that the green squares (corresponding to yhat_1) are a bit closer to the actual values than the red crosses (corresponding to yhat_0). This would suggest that dividing the players into the two bins according to their 2014 batting average and using the average BA_2015 value within each bin as our forecast was better than using the overall average BA_2015 value for all players.</p>
<p>Of course, we can continue with this line of reasoning and divide the players into even more bins. When we do that, instead of hand-coding the vector of cut points, we can use the function <code>seq()</code> which generates a vector of equally spaced numbers. To demonstrate, suppose we wanted to divide the interval [0,1] into 10 equally sized intervals: (0,0.1], (0.1, 0.2], …, (0.9, 1]. To get the vector of cutpoints, we need to tell <code>seq()</code> either how many points we wanted or the spacing between the points:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">11</span>)
 [<span class="dv">1</span>] <span class="fl">0.0</span> <span class="fl">0.1</span> <span class="fl">0.2</span> <span class="fl">0.3</span> <span class="fl">0.4</span> <span class="fl">0.5</span> <span class="fl">0.6</span> <span class="fl">0.7</span> <span class="fl">0.8</span> <span class="fl">0.9</span> <span class="fl">1.0</span>
&gt;<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">0.1</span>)
 [<span class="dv">1</span>] <span class="fl">0.0</span> <span class="fl">0.1</span> <span class="fl">0.2</span> <span class="fl">0.3</span> <span class="fl">0.4</span> <span class="fl">0.5</span> <span class="fl">0.6</span> <span class="fl">0.7</span> <span class="fl">0.8</span> <span class="fl">0.9</span> <span class="fl">1.0</span></code></pre></div>
<p>So let’s say we wanted to divde the 2014 batting averages into intervals of length 0.05 and predict 2015 batting averages using the average BA_2015 values within the resulting bins. We could run</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>batting_2014_2015 &lt;-<span class="st"> </span>
+<span class="st">   </span>batting_2014_2015 %&gt;%
+<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">bins =</span> <span class="kw">cut</span>(BA_2014, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">0.15</span>, <span class="dt">to =</span> <span class="fl">0.4</span>, <span class="dt">by =</span> <span class="fl">0.05</span>))) %&gt;%
+<span class="st">   </span><span class="kw">group_by</span>(bins) %&gt;%
+<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">yhat_2 =</span> <span class="kw">mean</span>(BA_2015)) %&gt;%
+<span class="st">   </span><span class="kw">ungroup</span>() %&gt;%
+<span class="st">   </span><span class="kw">select</span>(-bins)</code></pre></div>
<p>We can also visualize our new predictions, this time with blue triangles</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">ggplot</span>(batting_2014_2015) +
+<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BA_2014, <span class="dt">y =</span> BA_2015), <span class="dt">shape =</span> <span class="dv">16</span>, <span class="dt">size =</span> <span class="fl">0.9</span>) +<span class="st"> </span>
+<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BA_2014, <span class="dt">y =</span> yhat_0), <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">shape =</span> <span class="dv">3</span>, <span class="dt">size =</span> <span class="fl">0.75</span>) +<span class="st"> </span>
+<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BA_2014, <span class="dt">y =</span> yhat_1), <span class="dt">col =</span> <span class="st">&#39;green&#39;</span>, <span class="dt">shape =</span> <span class="dv">15</span>, <span class="dt">size =</span> <span class="fl">0.75</span>) +
+<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BA_2014, <span class="dt">y =</span> yhat_2), <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">shape =</span> <span class="dv">17</span>, <span class="dt">size =</span> <span class="fl">0.75</span>)</code></pre></div>
<p><img src="lecture4_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>It appears that we are able to perfectly predict the 2015 batting average of the player with the lowest batting average in 2014. Why do you think this was the case?</p>
<p>Let’s add two more predictions in which we divide the 2014 batting averages into bins of length 0.005 and 0.001. The code below generates these predictions, saves them to columns called “yhat_3” and “yhat_4” in our tbl, and then adds the predictions to the plot in purple and orange.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>batting_2014_2015 &lt;-<span class="st"> </span>
+<span class="st">   </span>batting_2014_2015 %&gt;%
+<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">bins =</span> <span class="kw">cut</span>(BA_2014, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">0.15</span>, <span class="dt">to =</span> <span class="fl">0.4</span>, <span class="dt">by =</span> <span class="fl">0.005</span>))) %&gt;%
+<span class="st">   </span><span class="kw">group_by</span>(bins) %&gt;%
+<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">yhat_3 =</span> <span class="kw">mean</span>(BA_2015)) %&gt;%
+<span class="st">   </span><span class="kw">ungroup</span>() %&gt;%
+<span class="st">   </span><span class="kw">select</span>(-bins)
&gt;<span class="st"> </span>
<span class="er">&gt;</span><span class="st"> </span>batting_2014_2015 &lt;-<span class="st"> </span>
+<span class="st">   </span>batting_2014_2015 %&gt;%
+<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">bins =</span> <span class="kw">cut</span>(BA_2014, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">0.15</span>, <span class="dt">to =</span> <span class="fl">0.4</span>, <span class="dt">by =</span> <span class="fl">0.001</span>))) %&gt;%
+<span class="st">   </span><span class="kw">group_by</span>(bins) %&gt;%
+<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">yhat_4 =</span> <span class="kw">mean</span>(BA_2015)) %&gt;%
+<span class="st">   </span><span class="kw">ungroup</span>() %&gt;%
+<span class="st">   </span><span class="kw">select</span>(-bins)
&gt;<span class="st"> </span>
<span class="er">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(batting_2014_2015) +
+<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BA_2014, <span class="dt">y =</span> BA_2015), <span class="dt">shape =</span> <span class="dv">16</span>, <span class="dt">size =</span> <span class="fl">0.9</span>) +<span class="st"> </span>
+<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BA_2014, <span class="dt">y =</span> yhat_0), <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">shape =</span> <span class="dv">3</span>, <span class="dt">size =</span> <span class="fl">0.75</span>) +<span class="st"> </span>
+<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BA_2014, <span class="dt">y =</span> yhat_1), <span class="dt">col =</span> <span class="st">&#39;green&#39;</span>, <span class="dt">shape =</span> <span class="dv">15</span>, <span class="dt">size =</span> <span class="fl">0.75</span>) +
+<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BA_2014, <span class="dt">y =</span> yhat_2), <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">shape =</span> <span class="dv">17</span>, <span class="dt">size =</span> <span class="fl">0.75</span>) +<span class="st"> </span>
+<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BA_2014, <span class="dt">y =</span> yhat_3), <span class="dt">col =</span> <span class="st">&#39;purple&#39;</span>, <span class="dt">shape =</span> <span class="dv">8</span>, <span class="dt">size =</span> <span class="fl">0.75</span>) +<span class="st"> </span>
+<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> BA_2014, <span class="dt">y =</span> yhat_4), <span class="dt">col =</span> <span class="st">&#39;orange&#39;</span>, <span class="dt">shape =</span> <span class="dv">10</span>, <span class="dt">size =</span> <span class="fl">0.75</span>)</code></pre></div>
<p><img src="lecture4_files/figure-html/yhat-34-1.png" width="672" /></p>
</div>
<div id="assessing-predictive-performance" class="section level2">
<h2>Assessing Predictive Performance</h2>
<p>We now have a couple of different ways of predicting BA_2015. Qualitatively, the predictions in purple (formed by binning BA_2014 into very small intervals) appear to fit the observed data better than the blue, green, and red predictions. To assess the predictions quantitatively, we often rely on the root mean square error or RMSE. This is the square root of the mean square error (MSE), which is computed by averaging the squared difference between the actual values and the predicted values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">summarize</span>(batting_2014_2015, 
+<span class="st">           </span><span class="dt">rmse_0 =</span> <span class="kw">sqrt</span>(<span class="kw">mean</span>((BA_2015 -<span class="st"> </span>yhat_0)^<span class="dv">2</span>)),
+<span class="st">           </span><span class="dt">rmse_1 =</span> <span class="kw">sqrt</span>(<span class="kw">mean</span>((BA_2015 -<span class="st"> </span>yhat_1)^<span class="dv">2</span>)),
+<span class="st">           </span><span class="dt">rmse_2 =</span> <span class="kw">sqrt</span>(<span class="kw">mean</span>((BA_2015 -<span class="st"> </span>yhat_2)^<span class="dv">2</span>)),
+<span class="st">           </span><span class="dt">rmse_3 =</span> <span class="kw">sqrt</span>(<span class="kw">mean</span>((BA_2015 -<span class="st"> </span>yhat_3)^<span class="dv">2</span>)),
+<span class="st">           </span><span class="dt">rmse_4 =</span> <span class="kw">sqrt</span>(<span class="kw">mean</span>((BA_2015 -<span class="st"> </span>yhat_4)^<span class="dv">2</span>)))
<span class="co"># A tibble: 1 x 5</span>
  rmse_0 rmse_1 rmse_2 rmse_3 rmse_4
   &lt;dbl&gt;<span class="st">  </span><span class="er">&lt;</span>dbl&gt;<span class="st">  </span><span class="er">&lt;</span>dbl&gt;<span class="st">  </span><span class="er">&lt;</span>dbl&gt;<span class="st">  </span><span class="er">&lt;</span>dbl&gt;
<span class="dv">1</span> <span class="fl">0.0257</span> <span class="fl">0.0244</span> <span class="fl">0.0226</span> <span class="fl">0.0185</span> <span class="fl">0.0113</span></code></pre></div>
<p>The RMSEs confirm what we could see visually: the purple predictions fit the data much better than the blue, green, and red predictions. Moreover we see that the predictions formed by binning into smaller intervals yielded smaller RMSEs than the predictions formed by binning into larger intervals.</p>
<p>Despite the fact that the orange predictions are even better than the purple predictions, we notice something worrying about these two predictions: they are not monotonic. Intuitively, we would expect that players with larger 2014 batting averages have, on average, larger 2015 batting averages than players with smaller 2014 batting averages. The reason that our predictions are not monotonic is that some of the bins contain only a single data point.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
